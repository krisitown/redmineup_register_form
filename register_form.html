<!-- jquery and bootstrap -->

<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.bundle.min.js"></script>

<!-- validation framework -->
<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.17.0/dist/jquery.validate.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.17.0/dist/additional-methods.min.js"></script>

<!-- bootstrap css -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">

<!-- cdn links end -->

<!-- stylesheet link -->
<link rel="stylesheet" href="register_form.css">

<div class="col-md-12">
    <img src="ru_logo_color.png" class="img-responsive col-md-8 col-md-offset-* "/>
</div>

<div class="row">
    <div class="col-md-6">
        <img src="scrum_meeting_agile.png" />
    </div>
    <div class="col-md-6">
    <form id="registerForm">
        <div id="errors" class="alert alert-danger"></div>
        <div class="form-group">
            <input type="text" placeholder="Domain Name" required id="web" />.redmineup.com
        </div>

        <div class="form-group">
            <label>Please select your plan</label></br>
            <select id="tariff">
                <option value="small">Small (5 users) </option>
                <option value="medium">Medium (25 Users) </option>
                <option value="business">Business (100 Users) </option>
                <option value="enterprise">Enterprise (Unlimited Users) </option>
            </select>
        </div>

        <div class="form-group">
            <input type="text" placeholder="First name" required id="firstName" />
            <input type="text" placeholder="Last name" required id="lastName" />
        </div>

        <div class="form-group">
            <input type="email" placeholder="Email address" required id="email" />
        </div>

        <div class="form-group">
            <input type="text" placeholder="Telephone number" required id="contact_phone" />
        </div>

        <div class="form-group">
            <label>What exactly we can help you with?</label></br>
            <select id="goal">
                <option value="project_management">Project management</option>
                <option value="customer_support">Customer support (Helpdesk)</option>
                <option value="crm">Sales & Marketing (CRM)</option>
                <option value="ecommerce_management">E-commerce management (Finance & Invoicing)</option>
                <option value="software_development">Software development (Agile)</option>
                <option value="hr_management">Human resources management (People)</option>
                <option value="everything">Launch a Startup (I need all of these)</option>
            </select>
        </div>

        <div class="form-group">
            <label>What do you prefer to use after trail?</label></br>
            <input type="radio" name="service_type" value="cloud" required /> Cloud
            <input type="radio" name="service_type" value="self_hosted" required /> Self-hosted
        </div>

        <div class="form-group">
            <input class="btn btn-primary" type="submit" value="Create my account" id="submitForm"/>
        </div>
    </form>
    <div id="success">
        <img src="check.png" class="img-responsive col-md-8 col-md-offset-* "/>
        <h4>Well done, check your inbox</h4>
        <span>Your instance will be ready in 1 minute. Have a nice trail :)</span>
    </div>
    </div>
</div>

<script>
$(document).ready(function(){
    $('#success').hide()
    $('#errors').hide()
    $('#registerForm').submit(function(event){
        event.preventDefault();

        $('.invalidField').removeClass('invalidField');

        let formData = {
            name:  $('#web').val(),
            firstname: $('#firstName').val(),
            lastname: $('#lastName').val(),
            email: $('#email').val(),
            tariff: $('#tariff').val(),
            contact_phone: $('#contact_phone').val(),
            service: $('input[name=service_type]:checked').val(),
            goal: $('#goal').val()
        }
        
        $.ajax({
            method: "post",
            data: formData,
            url: 'https://admin.redmineup.com/saas/register.json',
            crossDomain: true,
            success: function(data){
                if(data.success){
                    $('#registerForm').hide()
                    $('#success').show()
                    console.log(data);
                } else {
                    console.log(data.errors);
                    let errorMessage = '';
                    for(let i = 0; i < data.errors.length; i++){
                        errorMessage += data.errors[i] + '\n';
                        errorFieldSelector = '#' + data.errors[i].split(' ')[0].toLowerCase();
                        $(errorFieldSelector).addClass('invalidField');
                    }
                    $('#errors').html(errorMessage);
                    $('#errors').show()
                }
            },
            error: function(data){
                console.log('error!')
                console.log(data)
            }
        })
    });
});
$('#registerForm').validate({
    errorPlacement: function(error,element) {
        return true;
    }
});

$('#submitForm').prop('disabled', !$('#registerForm').valid());
$('#registerForm input').on('change', function(){
    $(this).removeClass('invalidField');
    $('#submitForm').prop('disabled', !$('#registerForm').valid());
})
</script>